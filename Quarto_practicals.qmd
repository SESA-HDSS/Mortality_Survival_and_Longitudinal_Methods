---
title: "Reproducible Reporting in R using Quarto"
author: Yohanis Alemeshet
format:
 html:
  toc: true
toc-location: left
editor: visual
bibliography: references.bib
editor_options: 
  chunk_output_type: inline
---

# Introduction

This is a quarto practical using the **Mortality** and [**Gapminder**](https://www.gapminder.org/) dataset.

## Installing and loading packages

### Installing packages

For packages, it is important to set the CRAN mirror to avoid issues during installation, and it's a good practice to install packages before rendering.

```{r}
#| label: installing packages
#| include: false
# Uncomment and install the following packages (preferably in your console)
#install.packages("gapminder")
#install.packages("plotly")
#install.packages("gt")

```

### Loading packages

```{r}
#| label: load-packages
#| message: false
#| warning: false
library(tidyverse)
library(haven)
library(skimr)
library(gapminder)
library(gt)
library(plotly)
```

## Import dataset

```{r}
#| label: Importing dataset
mortality <- read_dta("Data/mortality17.dta")
mortality <- as_factor(mortality)
glimpse(mortality) 
```

# Data visualization

## Table

@tbl-death-at-younger-age below shows deaths at a younger age with higher diastolic blood pressure from the mortality dataset.

```{r}
#| label: tbl-death-at-younger-age
#| tbl-cap: Death at younger age
mortality |> 
  select(age, sex, diastolic, systolic, died) |>
  filter(age<50, diastolic > 90, died==1) |> 
  gt()
```

## Figure

@fig-SBP-by-age below shows a scatter plot of systolic blood pressure by age.

```{r}
#| label: fig-SBP-by-age
#| fig-cap: A scatter plot of sbp by age
#| warnings: false
SBP <- ggplot(mortality, aes(x = age, y = systolic)) +
  geom_point(aes(color = sex), alpha=0.7) +
  # geom_smooth(method ~ "lm") +
  theme_bw() +
  labs(title = "Blood Pressure by Sex (Color) and Area (Shape)", x = "Age in years", y = "Systolic (mmHg)")

ggplotly(SBP)
```

## Using the Gapminder data

Gapminder combines data from multiple sources into unique, coherent time-series that canâ€™t be found elsewhere.[@bryan2015]

The table below displays the Gapminder data of Ethiopia.

```{r}
#| label: Gapminder-Ethiopia
#| tbl-cap: Gapminder data of Ethiopia (1952 - 2007)
gapminder <- gapminder
glimpse(gapminder)
gapminder |> 
  filter(country == "Ethiopia") |> 
  gt()
```

### Animated visualisation

```{r}
#| label: gapminder-visualisation
#| fig-cap: Life expectancy by GDP per Capita from 1952 - 2007 

A <- ggplot(gapminder, aes(gdpPercap, lifeExp, color = continent)) +
  geom_point(aes(size = pop, frame = year, ids = country)) + 
  scale_x_log10()
#A
An_fig <- ggplotly(A)

An_fig <- An_fig |>  
  animation_opts(
    1000, easing = "linear", redraw = FALSE)

An_fig
```

## Rendering into PDF

Rendering into PDF needs installing packages in your terminal and R.

```{r}
## Install Latex in Terminal (Uncomment and install the following in terinal)
#quarto install tinytex

#Installing in R (Uncomment and install the following in R)
# install.packages("tinytex") 
# tinytex::install_tinytex()
```
